<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Глава 4. Работа в графической оболочке.</title><link rel="stylesheet" href="docbook.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="index.html" title="Установка FreeBSD в качестве рабочей станции"><link rel="up" href="index.html" title="Установка FreeBSD в качестве рабочей станции"><link rel="prev" href="ar01s04.html" title="Глава 3. Запуск X-сервера."><link rel="next" href="ar01s06.html" title="5. Поддержание системы в актуальном состоянии."></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Глава 4. Работа в графической оболочке.</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ar01s04.html">Пред.</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ar01s06.html">След.</a></td></tr></table><hr></div><div class="section" lang="ru"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="id380400"></a>Глава 4. Работа в графической оболочке.</h2></div></div></div><p>Вот, собственно говоря, мы и подошли к самому интересному для нас - запуску графической оболочки, которая позволит нам использовать компьютер для работы. Все дальнейшие действия лучше выполнять от имени обычного пользователя, а не root (графическая оболочка имеет очень сложную структуру и множество различных компонентов, поэтому может стать объектом атаки по сети).</p><p>Самый простой способ запустить графическую оболочку - выполнить команду startkde (для KDE) или gnome-session (для Gnome) после запуска команды startx, однако в этом случае мы получаем довольно "кривое" отображение. Лучшим способом будет указать X-серверу загружать нужную нам графическую оболочку при запуске. Сделать это можно создав файл .xinitrc в нашем домашнем каталоге и указать в нём какие команды необходимо выполнять при запуске xorg:
</p><pre class="screen">
$ cd ~
$ touch .xinitrc
$ ee .xinitrc
</pre><p>
В открывшемся окне редактора пишем следующее:
</p><pre class="programlisting">
gnome-session
</pre><p>
После этого выходим из редактора с сохранением. Теперь можем вновь дать команду startx. После её запуска на экране должна появиться заставка Gnome. На этом установку системы можно считать законченной :-) Теперь нужно только установить необходимые программы и уже можно работать.</p><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id380476"></a>4.1. Включаем звук.</h3></div></div></div><p>Первое, что вы могли заметить при запуске - табличку с сообщением о невозможности запустить звуковую систему (или просто отсутствие каких-либо звуков). А какой современный компьютер без музыки скажете вы. Поэтому мы сейчас займёмся запуском звука. Собственно звук не привязан к графической оболочке, скорее графическая оболочка использует звуковую систему для уведобления пользователя о событиях..</p><p>Благодаря стараниям разработчиков системы мы имеем огромные набор драйверов для звуковых плат. Осталось разобраться какой драйвер нам нужен.
Самый простой способ задействовать вашу звуковую карту - подключить модуль ядра, умеющий работать с вашей звуковой платой. Найти его несложно. Перед началом настройки выгрузим графическую оболочку. Модули ядра расположены в папке /boot/kernel. Файлы звуковых драйверов имеют название, начинающееся с snd_
</p><pre class="screen">
# cd /boot/kernel
# la snd_*
</pre><p>
Таким образом мы получили список имеющихся драйверов. Самым простой способ найти какой же необходим нам - загрузить все модули. Делается это загрукой модуля snd_sound.ko:
</p><pre class="screen">
# kldload snd_driver
</pre><p>
После этого действия на первой текстовой консоли должны появиться сообщения о найденных устройствах. Если этого не произошло, сожалею, поддержки вашей звуковой платы в системе нет. Нужно искать сторонние драйвера. Однако мне ещё не встречались такие случаи.</p><p>Итак, драйвера загружены, а какой же из них наш. Выполняем команду:
</p><pre class="screen">
# cat /dev/sndstat
</pre><p>
В ответ нам выдаётся сообщение о задействованных звуковых модулях. Внимательно его изучаем и находим нужного нам модуля. После этого выполняем перезагрузку и пробуем загрузить этот модуль с помощью команды
</p><pre class="screen">
# kldload snd_hda
</pre><p>
где snd_hda заменяем на имя нужного нам модуля. Если после загрузки мы увидели те же самые сообщения, что и в первом случае, то модуль ядра успешно найден. Если сообщения не появились, то возвращаемся к началу и внимательней изучаем содержание sndstat.</p><p>Для того, чтобы нужный нам модуль загружался автоматически, необходимо отредактировать файл /boot/loader.conf
</p><pre class="screen">
# ee /boot/loader.conf
</pre><p>
Добавляем туда строчку следующего содержания:
</p><pre class="programlisting">
snd_hda_load="YES"
</pre><p>
где snd_hda заменяем названием нужного вам модуля. После этого перезагружаемся:
</p><pre class="screen">
# reboot
</pre><p>
и внимательно изучаем сообщения при загрузке системы. В них мы должны найти сообщения об успешной активации вашей звуковой карты.</p><p>Ещё одним способом является включение необходимого модуля непосредственно в ядро системы. Однако это требует пересборки ядра, чем мы займёмся немного позднее.</p><p>Если всё загружено успешно, заходим в систему под непривилегированным пользователем и запускаем графичекую оболочку:
</p><pre class="screen">
# startx
</pre><p>
Система должна нас приветствовать радостной мелодией!</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id380651"></a>4.2. Установка кириллических шрифтов.</h3></div></div></div><p>В составе системы имеются различные шрифты, то при отображении сайтов, которые разрабатывались в Windows мы теряем внешний вид. Раньше я предпочитал устанавливать набор ttf шрифтов из Windows, поэтому сначала рассмотрим этот вариант.
Первым делом нужно скопировать шрифты *.ttf из папки Windows/Fonts в папку, например,  /usr/X11R6/lib/X11/fonts/win-ttf. Далее необходимо проделать несколько действий:
</p><pre class="screen">
# cd /usr/X11R6/lib/X11/fonts/win-ttf
# mkfontscale
# mkfontdir
</pre><p>
после этих действий в папке должны появиться два файла font.dir и font.scale</p><p>Последнее действие:
</p><pre class="screen">
# fc-cache /usr/X11R6/lib/X11/fonts/win-ttf
</pre><p>
Запускаем графическую оболочку и пользуемся шрифтами.</p><p>Кроме этого, наборы шрифтов можно найти в портах /usr/ports/x11-fonts. Сейчас я использую порт /usr/ports/x11-fonts/webfonts.</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id380712"></a>4.3. Слушаем музыку.</h3></div></div></div><p>Для прослушивания музыки существует масса проигрыватель. Раньше я был любителем Winamp, поэтому на первых порах выбрал проигрыватель XMMS. Найти проигрыватель можно в портах:
</p><pre class="programlisting">
/usr/ports/multimedia/xmms
</pre><p>
Однако данный порт не совсем корректно работает с кириллицей. Решить некоторое количество проблем с кодировками можно установив XMMS посредством порта
</p><pre class="programlisting">
/usr/ports/russian/xmms
</pre><p>
В этом случае мы получаем тот же самый проигрыватель, но с поддержкой перекодировки тегов и имён файлов. Хотя мне так и не удалось заставить XMMS корректно сортировать песни в плейлисте.</p><p>В настоящее время я использую связку musicpd (демон, работащий в фоне и проигрывающий музыку) и gmpc (графическая оболочка для управления демоном).</p></div><div class="section" lang="ru"><div class="titlepage"><div><div><h3 class="title"><a name="id380760"></a>4.4. Записываем диски CD/DVD.</h3></div></div></div><p>Редкий современный компьютер обходится без пишущего привода. Поскольку мы делаем рабочую станцию, то хотелось бы научиться также писать CD и DVD диски.</p><p>Наверняка вы слышали о таких программах, как burncd и cdrecord - консольные утилиты для записи CD. Не будем недооценивать их мощи, но наверняка вам хотелось бы иметь более удобный инструмент для записи. Таким инструментом по праву может стать программа k3b или brasero в составе Gnome:
</p><pre class="programlisting">
/usr/ports/sysutils/k3b
</pre><p>
Собственно говоря эта программы сами не умеет писать диски, а просто управляет утилитами для записи. Отсюда вытекает необходимость в настройке этой утилиты. Кроме того, если вы собираетесь записывать DVD диски, то необходимо установить дополнительные утилиты для работы с DVD. О том, что нужно добавить, вам расскажет сам k3b.</p><p>Как известно, утилита умеет работать только со SCSI устройствами, поэтому первое что мы должны сделать - подгрузить модуль ядра atapicam для обеспечения эмуляции SCSI устройства для нашего CD/DVD привода. Выполняем команду:
</p><pre class="screen">
# kldload atapicam
</pre><p>
Первая консоль должна отреагировать положительно и объявить о появлении нового устройства cd0, также должен появиться файл устройства /dev/cd0.
Первый подводный камень с которым мне пришлось встретиться - зависание системы после загрузки модуля ядра. Как выяснилось позже  виновником был SATA контроллер на материнской плате. Поскольку у меня на компьютере нет SATA жёстких дисков, я попросту его отключил. Если у вас возникла аналогичная проблема и вам нужен SATA контроллер, можно попробовать поиграться с порядком контроллеров в системе. После этого, к сожалению, придётся заново настраивать файл /etc/fstab, а чтобы его отредактировать, научиться пользоваться утилитой fixit с дистрибутивного диска FreeBSD.</p><p>Если загрузка atapicam прошла успешно, не забываем поместить его в автозагрузку:
</p><pre class="screen">
# ee /boot/loader.conf
</pre><p>
Добавляем в него строку
</p><pre class="programlisting">
atapicam_load="YES"
</pre><p>
Не возбраняется также добавить atapicam непосредственно в ядро системы при пересборке ядра, тогда загружать его через locader.conf не нужно.</p><p>Далее нам необходимо проверить, нашла ли утилита cdrecord наш привод/приводы. Выполняем команду:
</p><pre class="screen">
# cdrecord -scanbus
</pre><p>
В ответ мы должны получить примерно следующее:
</p><pre class="screen">
Cdrecord-Clone 2.01 (i386-unknown-freebsd6.1) Copyright (C) 1995-2004 JЖrg Schilling
Using libscg version 'schily-0.8'.
scsibus1:
        1,0,0   100) '_NEC    ' 'DVD_RW ND-4571A ' '1-02' Removable CD-ROM
        1,1,0   101) *
        1,2,0   102) *
        1,3,0   103) *
        1,4,0   104) *
        1,5,0   105) *
        1,6,0   106) *
        1,7,0   107) *
</pre><p>
Т.е. в моём случае cdrecord нашла привод NEC ND-4571A.</p><p>На радостях запускаем k3b, но обнаруживаем, что она отказывается видеть наш привод. Почему? Просто все предыдущие команды мы выполняли от пользователя root, а k3b мы запускаем от имени обычного пользователя. Можете попробовать запустить k3b от имени root и убедиться, что программа определяет привод, но нам было бы удобнее и безопаснее работать от имени обычного пользователя. Решением этой проблемы сейчас и займёмся. Самый простой способ выполнить следующую последовательность команд:
</p><pre class="screen">
# cd /dev
# chmod 0666 acd0 cd0 xpt0 pass0
</pre><p>
Устройства xpt0 и pass0 также необходимы для выполнения записи на диск. После выполнения команд можно запустить k3b и убедиться, что привод определяется. Однако после перезагрузки необходимо будет заново выполнять эту последовательность команд. Чтобы избавиться от этого, воспользуемся файлом /etc/devfs.conf. Через этот файл можно задавать владельца и права доступа на файлы устройств при загрузке системы.</p><p>Начиная работать с правами сделаем также так, чтобы права на запись диском имели только строго определённые пользователи. Как вы могли заметить, все используемые устройства принадлежат к группе operator. Для разрешения записи мы просто добавим нужного пользователя к этой группе при помощи команды:
</p><pre class="screen">
# pw usermod USERNAME -G operator,wheel
</pre><p>
Обратите внимание, что мы в данном случае также присвоили пользователю группу wheel, благодаря чему дали ему возможность выполнять команду su root, если этого не нужно, то группу wheel можно не указывать. Также обратите внимание на регистр буквы G перед списком групп. Ни в коем случае не используйте g, т.к. она предназначена для задания основной группы пользователя (а её название как правило совпадает с именем пользователя и эта группа может быть только единственной группой).</p><p>Итак, зададим необходимые права доступа на файлы:
</p><pre class="screen">
# ee /etc/devfs.conf
</pre><p>
добавим в него следующие строки
</p><pre class="programlisting">
perm    acd0    0660
perm    cd0     0660
perm    xpt0    0660
perm    pass0   0660
</pre><p>
Таким образом мы разрешим доступ к устройствам для root и группы operator.
Можно также добавить следующие строки
</p><pre class="programlisting">
own     acd0    root:operator
own     cd0     root:operator
own     xpt0    root:operator
own     pass0    root:operator
</pre><p>
Однако во FreeBSD 6.1 данные файлы и так имеют вышеуказанных владельца и группу. Однако кто знает что будет в следующих версиях, поэтому эти строки лишними не будут.</p><p>На этом можно заканчивать. Теперь достаточно перезагрузить систему и проверить, что вы можете успешно записывать CD и DVD диски.
</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Замечание</h3><p>После нескольких экспериментов с системой я вдруг обнаружил, что k3b потерял мой DVD привод. Решение оказалось допольно простым, просто у меня появилось ещё одно устройство pass1, которое и нужно было для нормальной работы DVD привода.</p></div><p>
</p></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ar01s04.html">Пред.</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ar01s06.html">След.</a></td></tr><tr><td width="40%" align="left" valign="top">Глава 3. Запуск X-сервера. </td><td width="20%" align="center"><a accesskey="h" href="index.html">Начало</a></td><td width="40%" align="right" valign="top"> 5. Поддержание системы в актуальном состоянии.</td></tr></table></div><p>
<script type="text/javascript"><!--
google_ad_client = "pub-2522071277043261";
/* 728x90, ъмцдчлм 06.04.10 */
google_ad_slot = "9637373437";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p>
</body></html>
